<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>××¢×‘×“×ª ×”×—×™×¡×•×¨ / Subtraction Lab</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="alternate icon" type="image/png" href="favicon.png">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
        }

        @keyframes fly-emoji {
            0%   { transform: translate(-50%, -50%) rotate(var(--angle)) translateX(0px);    opacity: 1; font-size: 1.8rem; }
            60%  { opacity: 1; }
            100% { transform: translate(-50%, -50%) rotate(var(--angle)) translateX(320px); opacity: 0; font-size: 3rem; }
        }
        @keyframes celebration-bg-fade {
            0%   { opacity: 1; }
            70%  { opacity: 1; }
            100% { opacity: 0; pointer-events: none; }
        }
        @keyframes correct-bounce {
            0%,100% { transform: scale(1); }
            30%     { transform: scale(1.25) rotate(-3deg); }
            60%     { transform: scale(1.15) rotate(3deg); }
        }
        @keyframes wrong-shake {
            0%,100% { transform: translateX(0); }
            20%     { transform: translateX(-10px); }
            40%     { transform: translateX(10px); }
            60%     { transform: translateX(-7px); }
            80%     { transform: translateX(7px); }
        }
        @keyframes score-pop {
            0%   { transform: scale(1); }
            50%  { transform: scale(1.4); }
            100% { transform: scale(1); }
        }
        .correct-bounce { animation: correct-bounce 0.6s ease; }
        .wrong-shake    { animation: wrong-shake 0.5s ease; }
        .score-pop      { animation: score-pop 0.4s ease; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide React icons as inline SVG components
        const Minus = ({ size = 24, className = '' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Apple = ({ size = 24, className = '', fill = 'none' }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z"></path>
                <path d="M10 2c1 .5 2 2 2 5"></path>
            </svg>
        );

        function SubtractionLab() {
            const [startNum, setStartNum] = useState(9);
            const [subtractNum, setSubtractNum] = useState(2);
            const [activeTab, setActiveTab] = useState('numberline');
            const [userAnswer, setUserAnswer] = useState('');
            const [showResult, setShowResult] = useState(false);
            const [direction, setDirection] = useState('back');
            
            // Settings state
            const [firstNumMin, setFirstNumMin] = useState(5);
            const [firstNumMax, setFirstNumMax] = useState(13);
            const [subtractMin, setSubtractMin] = useState(0);
            const [subtractMax, setSubtractMax] = useState(13);
            const [randomSeed, setRandomSeed] = useState(null);
            const [dotSize, setDotSize] = useState('medium'); // 'small', 'medium', 'large'
            const [objectType, setObjectType] = useState('apple'); // 'apple', 'orange', 'banana', 'strawberry', 'ball'
            const [showStepCounter, setShowStepCounter] = useState(false);
            
            const [currentPosition, setCurrentPosition] = useState(null);
            const [steps, setSteps] = useState(0);
            const [startingPosition, setStartingPosition] = useState(null);
            
            const [removedApples, setRemovedApples] = useState([]);
            const [appleMode, setAppleMode] = useState('delete');
            const [showAppleNumbers, setShowAppleNumbers] = useState(false);
            const [countedApples, setCountedApples] = useState([]);
            
            const [closedFingers, setClosedFingers] = useState([]);
            const [fingerMode, setFingerMode] = useState('mark');
            const [showFingerNumbers, setShowFingerNumbers] = useState(false);
            const [countedFingers, setCountedFingers] = useState([]);
            
            const correctAnswer = startNum - subtractNum;

            // Score tracking
            const [correctCount, setCorrectCount] = React.useState(0);
            const [wrongCount, setWrongCount]     = React.useState(0);

            // Celebration: { emojis: string[], key: number } | null
            const [celebration, setCelebration] = React.useState(null);
            const [resultAnimKey, setResultAnimKey] = React.useState(0);

            // Celebration themes
            const celebrationThemes = [
                ['ğŸ‰','ğŸŠ','ğŸˆ','ğŸ','ğŸ€'],
                ['â­','ğŸŒŸ','ğŸ’«','âœ¨','ğŸŒ '],
                ['â¤ï¸','ğŸ’•','ğŸ’–','ğŸ’—','ğŸ’'],
                ['ğŸ¦‹','ğŸŒˆ','ğŸŒ¸','ğŸŒº','ğŸŒ»'],
                ['ğŸµ','ğŸ¶','ğŸ¸','ğŸ¹','ğŸº'],
                ['ğŸ­','ğŸ¬','ğŸ«','ğŸ§','ğŸ°'],
            ];

            const triggerCelebration = (objEmoji) => {
                const baseTheme = celebrationThemes[Math.floor(Math.random() * celebrationThemes.length)];
                const emojis = [...baseTheme, objEmoji, objEmoji];
                setCelebration({ emojis, key: Date.now() });
                setTimeout(() => setCelebration(null), 2600);
            };

            // Initialize seed on first load from full timestamp
            useEffect(() => {
                if (randomSeed === null) {
                    const seed = Date.now(); // Full timestamp in milliseconds
                    setRandomSeed(seed);
                }
                
                // Load settings from localStorage
                const savedSettings = localStorage.getItem('subtractionLabSettings');
                if (savedSettings) {
                    try {
                        const settings = JSON.parse(savedSettings);
                        if (settings.firstNumMin !== undefined) setFirstNumMin(settings.firstNumMin);
                        if (settings.firstNumMax !== undefined) setFirstNumMax(settings.firstNumMax);
                        if (settings.subtractMin !== undefined) setSubtractMin(settings.subtractMin);
                        if (settings.subtractMax !== undefined) setSubtractMax(settings.subtractMax);
                        if (settings.dotSize !== undefined) setDotSize(settings.dotSize);
                        if (settings.objectType !== undefined) setObjectType(settings.objectType);
                    } catch (e) {
                        console.log('Could not load settings');
                    }
                }
            }, []);
            
            // Generate initial question when seed is ready
            useEffect(() => {
                if (randomSeed !== null && startNum === 9 && subtractNum === 2) {
                    // Only generate on first load (when still at default values)
                    generateNewQuestion();
                }
            }, [randomSeed]);
            
            // Save settings to localStorage whenever they change
            useEffect(() => {
                const settings = {
                    firstNumMin,
                    firstNumMax,
                    subtractMin,
                    subtractMax,
                    dotSize,
                    objectType
                };
                localStorage.setItem('subtractionLabSettings', JSON.stringify(settings));
            }, [firstNumMin, firstNumMax, subtractMin, subtractMax, dotSize, objectType]);
            
            // Seeded random number generator - returns integer in [min, max]
            const seededRandom = (min, max, currentSeed) => {
                const x = Math.sin(currentSeed) * 10000;
                const random = x - Math.floor(x);
                return Math.floor(random * (max - min + 1)) + min;
            };

            // Seeded random float in [0, 1)
            const seededRandomFloat = (currentSeed) => {
                const x = Math.sin(currentSeed) * 10000;
                return x - Math.floor(x);
            };

            // Sample from a triangular distribution on [a, b] with mode c, given uniform u in [0,1)
            // Returns a continuous value; caller should round to integer
            const triangularSample = (a, b, c, u) => {
                if (a === b) return a;
                // Clamp mode to valid range
                const mode = Math.max(a, Math.min(b, c));
                const fc = (mode - a) / (b - a);
                if (u < fc) {
                    return a + Math.sqrt(u * (b - a) * (mode - a));
                } else {
                    return b - Math.sqrt((1 - u) * (b - a) * (b - mode));
                }
            };
            
            // Generate new question
            const generateNewQuestion = () => {
                if (randomSeed === null) return;
                
                const newSeed = randomSeed + 1;
                setRandomSeed(newSeed);
                
                // Draw the first number uniformly from its range
                const newStartNum = seededRandom(firstNumMin, firstNumMax, newSeed);
                
                // Draw the second number from a triangular distribution:
                // - Bounded to [actualSubtractMin, actualSubtractMax]
                // - Mean targeted at newStartNum / 2
                //   For triangular(a, b, c): mean = (a + b + c) / 3
                //   => c = 3 * (newStartNum / 2) - a - b
                const actualSubtractMin = Math.max(0, subtractMin);
                const actualSubtractMax = Math.min(newStartNum, subtractMax);

                let newSubtractNum;
                if (actualSubtractMin > actualSubtractMax) {
                    // Degenerate range â€” clamp to nearest valid value
                    newSubtractNum = Math.min(newStartNum, subtractMin);
                } else if (actualSubtractMin === actualSubtractMax) {
                    newSubtractNum = actualSubtractMin;
                } else {
                    const targetMean = newStartNum / 2;
                    const mode = 3 * targetMean - actualSubtractMin - actualSubtractMax;
                    const u = seededRandomFloat(newSeed * 2);
                    const sample = triangularSample(actualSubtractMin, actualSubtractMax, mode, u);
                    newSubtractNum = Math.round(sample);
                }
                
                setStartNum(newStartNum);
                setSubtractNum(newSubtractNum);
            };
            
            const resetLab = () => {
                setCurrentPosition(null);
                setSteps(0);
                setStartingPosition(null);
                setRemovedApples([]);
                setClosedFingers([]);
                setCountedApples([]);
                setCountedFingers([]);
            };
            
            const handleStartNumChange = (e) => {
                const value = e.target.value;
                if (value === '') {
                    setStartNum(0);
                } else {
                    const num = parseInt(value, 10);
                    if (!isNaN(num) && num >= 0 && num <= 20) {
                        setStartNum(num);
                    }
                }
            };
            
            const handleSubtractNumChange = (e) => {
                const value = e.target.value;
                if (value === '') {
                    setSubtractNum(0);
                } else {
                    const num = parseInt(value, 10);
                    if (!isNaN(num) && num >= 0 && num <= startNum) {
                        setSubtractNum(num);
                    }
                }
            };

            useEffect(() => {
                resetLab();
                setUserAnswer('');
                setShowResult(false);
                setAppleMode('delete');
                setShowAppleNumbers(false);
                setFingerMode('mark');
                setShowFingerNumbers(false);
            }, [startNum, subtractNum]);

            const NumberLineTab = () => {
                const maxNum = Math.max(startNum + 2, 10);
                const started = currentPosition !== null;
                
                // Get dot sizes based on setting
                const dotSizes = {
                    small: { starting: 8, current: 6, path: 4 },
                    medium: { starting: 12, current: 10, path: 6 },
                    large: { starting: 16, current: 13, path: 8 }
                };
                const sizes = dotSizes[dotSize];
                
                const handleClickNumber = (num) => {
                    if (!started) {
                        // First click - set starting position
                        setStartingPosition(num);
                        setCurrentPosition(num);
                        setSteps(0);
                    } else if (num === startingPosition) {
                        // Clicking the red dot - reset
                        resetLab();
                    } else {
                        // Clicking anywhere else - take a step (no limit)
                        if (direction === 'back') {
                            if (currentPosition > 0) {
                                setCurrentPosition(currentPosition - 1);
                                setSteps(steps + 1);
                            }
                        } else {
                            if (currentPosition < maxNum) {
                                setCurrentPosition(currentPosition + 1);
                                setSteps(steps + 1);
                            }
                        }
                    }
                };
                
                return (
                    <div className="space-y-6">
                        <div className="text-center space-y-3">
                            {!started ? (
                                <>
                                    <p className="text-lg">×‘×—×¨ ×›×™×•×•×Ÿ ×•××¡×¤×¨ ×”×ª×—×œ×”</p>
                                    <p className="text-lg">Choose direction and starting number</p>
                                    <div className="flex justify-center gap-4 items-center">
                                        <button
                                            onClick={() => setDirection('back')}
                                            className={`px-6 py-3 rounded-lg text-lg font-semibold ${
                                                direction === 'back' 
                                                    ? 'bg-red-500 text-white' 
                                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                            }`}
                                        >
                                            â¬…ï¸ ×¦×¢×“ ××—×•×¨×” / Step Back
                                        </button>
                                        <button
                                            onClick={() => setDirection('up')}
                                            className={`px-6 py-3 rounded-lg text-lg font-semibold ${
                                                direction === 'up' 
                                                    ? 'bg-green-500 text-white' 
                                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                            }`}
                                        >
                                            â¡ï¸ ×¦×¢×“ ×§×“×™××” / Step Up
                                        </button>
                                    </div>
                                </>
                            ) : (
                                <div className="space-y-3">
                                    <div className="text-center space-y-2">
                                        <p className="text-lg">×œ×—×¥ ×¢×œ ×”×¦×™×¨ ×›×“×™ ×œ×¦×¢×•×“ ××• ×”×©×ª××© ×‘×›×¤×ª×•×¨</p>
                                        <p className="text-lg">Click on axis to step or use button</p>
                                        <p className="text-sm text-gray-600">×œ×—×¥ ×¢×œ ×”× ×§×•×“×” ×”××“×•××” ×›×“×™ ×œ××¤×¡ / Click red dot to reset</p>
                                        {showStepCounter && (
                                            <p className="text-xl font-bold text-green-600">
                                                ×¦×¢×“×™×: {steps} / Steps: {steps}
                                            </p>
                                        )}
                                    </div>
                                    <div className="flex justify-center gap-4 flex-wrap items-center">
                                        <button
                                            onClick={() => {
                                                if (direction === 'back') {
                                                    if (currentPosition > 0) {
                                                        setCurrentPosition(currentPosition - 1);
                                                        setSteps(steps + 1);
                                                    }
                                                } else {
                                                    if (currentPosition < maxNum) {
                                                        setCurrentPosition(currentPosition + 1);
                                                        setSteps(steps + 1);
                                                    }
                                                }
                                            }}
                                            className={`px-8 py-4 rounded-lg text-2xl font-bold ${
                                                direction === 'back'
                                                    ? 'bg-red-500 text-white hover:bg-red-600'
                                                    : 'bg-green-500 text-white hover:bg-green-600'
                                            }`}
                                        >
                                            {direction === 'back' ? 'â¬…ï¸ ××—×•×¨×” / Back' : 'â¡ï¸ ×§×“×™××” / Up'}
                                        </button>
                                        <button
                                            onClick={resetLab}
                                            className="px-6 py-4 bg-blue-500 text-white rounded-lg text-xl hover:bg-blue-600"
                                        >
                                            ğŸ”„ ××™×¤×•×¡ / Reset
                                        </button>
                                    </div>
                                    <div className="flex justify-center">
                                        <label className="flex items-center gap-2 text-lg bg-white px-4 py-2 rounded-lg border-2 border-gray-300">
                                            <input
                                                type="checkbox"
                                                checked={showStepCounter}
                                                onChange={(e) => setShowStepCounter(e.target.checked)}
                                                className="w-5 h-5"
                                            />
                                            <span>×”×¦×’ ×¡×¤×™×¨×ª ×¦×¢×“×™× / Show Step Counter</span>
                                        </label>
                                    </div>
                                </div>
                            )}
                        </div>
                        
                        <div className="relative h-32 bg-gray-100 rounded-lg p-4">
                            {!started && (
                                <div className="absolute top-2 left-1/2 transform -translate-x-1/2 text-purple-600 font-semibold text-center">
                                    ×œ×—×¥ ×¢×œ ××¡×¤×¨ ×œ×”×ª×—×œ×”<br/>Click a number to start
                                </div>
                            )}
                            <svg className="w-full h-full">
                                <line x1="5%" y1="60%" x2="95%" y2="60%" stroke="#333" strokeWidth="3" />
                                
                                {started && steps > 0 && (
                                    <line 
                                        x1={`${5 + (90 / maxNum) * Math.min(startingPosition, currentPosition)}%`}
                                        y1="60%" 
                                        x2={`${5 + (90 / maxNum) * Math.max(startingPosition, currentPosition)}%`}
                                        y2="60%" 
                                        stroke="#10b981" 
                                        strokeWidth="6" 
                                    />
                                )}
                                
                                {Array.from({ length: maxNum + 1 }, (_, i) => {
                                    const x = 5 + (90 / maxNum) * i;
                                    const isStarting = started && i === startingPosition;
                                    const isCurrent = started && i === currentPosition && i !== startingPosition;
                                    const isInPath = started && steps > 0 && (
                                        (direction === 'back' && i < startingPosition && i > currentPosition) ||
                                        (direction === 'up' && i > startingPosition && i < currentPosition)
                                    );
                                    
                                    return (
                                        <g key={i}>
                                            <line x1={`${x}%`} y1="50%" x2={`${x}%`} y2="70%" stroke="#333" strokeWidth="2" />
                                            <text x={`${x}%`} y="85%" textAnchor="middle" className="text-lg font-bold">
                                                {i}
                                            </text>
                                            
                                            {/* Clickable area - always visible */}
                                            <circle 
                                                cx={`${x}%`} 
                                                cy="60%" 
                                                r="15" 
                                                fill="transparent"
                                                className={started ? "cursor-pointer hover:fill-blue-100" : "cursor-pointer hover:fill-blue-200"}
                                                onClick={() => handleClickNumber(i)}
                                            />
                                            
                                            {/* Starting position - red dot with reset cursor */}
                                            {isStarting && (
                                                <circle 
                                                    cx={`${x}%`} 
                                                    cy="60%" 
                                                    r={sizes.starting} 
                                                    fill="#ef4444"
                                                    className="cursor-pointer hover:opacity-80"
                                                    style={{ pointerEvents: 'none' }}
                                                />
                                            )}
                                            
                                            {/* Current position - blue dot */}
                                            {isCurrent && (
                                                <circle cx={`${x}%`} cy="60%" r={sizes.current} fill="#3b82f6" style={{ pointerEvents: 'none' }} />
                                            )}
                                            
                                            {/* Green dots for intermediate positions */}
                                            {isInPath && (
                                                <circle cx={`${x}%`} cy="60%" r={sizes.path} fill="#10b981" style={{ pointerEvents: 'none' }} />
                                            )}
                                        </g>
                                    );
                                })}
                            </svg>
                        </div>
                    </div>
                );
            };

            const ApplesTab = () => {
                const apples = Array.from({ length: startNum }, (_, i) => i);
                
                // Object names in Hebrew and English
                const objectNames = {
                    apple: { he: '×ª×¤×•×—×™×', en: 'apples', emoji: 'ğŸ', color: '#ef4444' },
                    orange: { he: '×ª×¤×•×–×™×', en: 'oranges', emoji: 'ğŸŠ', color: '#f97316' },
                    banana: { he: '×‘× × ×•×ª', en: 'bananas', emoji: 'ğŸŒ', color: '#fbbf24' },
                    strawberry: { he: '×ª×•×ª×™×', en: 'strawberries', emoji: 'ğŸ“', color: '#ef4444' },
                    ball: { he: '×›×“×•×¨×™×', en: 'balls', emoji: 'âš½', color: '#3b82f6' },
                    butterfly: { he: '×¤×¨×¤×¨×™×', en: 'butterflies', emoji: 'ğŸ¦‹', color: '#a855f7' },
                    unicorn: { he: '×—×“×™ ×§×¨×Ÿ', en: 'unicorns', emoji: 'ğŸ¦„', color: '#ec4899' },
                    mouse: { he: '×¢×›×‘×¨×™×', en: 'mice', emoji: 'ğŸ­', color: '#94a3b8' },
                    dress: { he: '×©××œ×•×ª', en: 'dresses', emoji: 'ğŸ‘—', color: '#f472b6' },
                    shoe: { he: '× ×¢×œ×™×™×', en: 'shoes', emoji: 'ğŸ‘ ', color: '#e879f9' },
                    cookie: { he: '×¢×•×’×™×•×ª', en: 'cookies', emoji: 'ğŸª', color: '#a16207' },
                    chair: { he: '×›×™×¡××•×ª', en: 'chairs', emoji: 'ğŸª‘', color: '#78716c' },
                    star: { he: '×›×•×›×‘×™×', en: 'stars', emoji: 'â­', color: '#eab308' },
                    shirt: { he: '×—×•×œ×¦×•×ª', en: 'shirts', emoji: 'ğŸ‘•', color: '#3b82f6' },
                    trousers: { he: '××›× ×¡×™×™×', en: 'trousers', emoji: 'ğŸ‘–', color: '#1d4ed8' },
                    clown: { he: '×œ×™×¦× ×™×', en: 'clowns', emoji: 'ğŸ¤¡', color: '#ec4899' }
                };
                const obj = objectNames[objectType];
                
                const handleAppleClick = (index) => {
                    if (removedApples.includes(index)) {
                        if (appleMode === 'delete') {
                            setRemovedApples(removedApples.filter(i => i !== index));
                        }
                        return;
                    }
                    
                    if (appleMode === 'delete') {
                        if (removedApples.length < subtractNum) {
                            setRemovedApples([...removedApples, index]);
                        }
                    } else {
                        if (countedApples.includes(index)) {
                            setCountedApples(countedApples.filter(i => i !== index));
                        } else {
                            setCountedApples([...countedApples, index]);
                        }
                    }
                };
                
                return (
                    <div className="space-y-6">
                        <div className="flex justify-center gap-4 items-center flex-wrap">
                            <button
                                onClick={() => {
                                    setAppleMode('delete');
                                    setCountedApples([]);
                                }}
                                className={`px-6 py-3 rounded-lg text-lg font-semibold flex items-center gap-2 ${
                                    appleMode === 'delete'
                                        ? 'bg-red-500 text-white'
                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }`}
                            >
                                ğŸ—‘ï¸ ××—×§ / Delete
                            </button>
                            <button
                                onClick={() => {
                                    setAppleMode('count');
                                    setCountedApples([]);
                                }}
                                className={`px-6 py-3 rounded-lg text-lg font-semibold flex items-center gap-2 ${
                                    appleMode === 'count'
                                        ? 'bg-green-500 text-white'
                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }`}
                            >
                                ğŸ”¢ ×¡×¤×•×¨ / Count
                            </button>
                            
                            {appleMode === 'count' && (
                                <label className="flex items-center gap-2 text-lg bg-white px-4 py-2 rounded-lg border-2 border-gray-300">
                                    <input
                                        type="checkbox"
                                        checked={showAppleNumbers}
                                        onChange={(e) => setShowAppleNumbers(e.target.checked)}
                                        className="w-5 h-5"
                                    />
                                    <span>×”×¦×’ ××¡×¤×¨×™× / Show Numbers</span>
                                </label>
                            )}
                        </div>
                        
                        <div className="text-center space-y-2">
                            {appleMode === 'delete' ? (
                                <>
                                    <p className="text-lg">×™×© ×œ×š {startNum} {obj.he}, ×”×•×¦× {subtractNum} {obj.he}</p>
                                    <p className="text-lg">You have {startNum} {obj.en}, remove {subtractNum} {obj.en}</p>
                                    {startNum > 0 && <p className="text-md text-gray-600">×œ×—×¥ ×¢×œ {obj.emoji} ×›×“×™ ×œ×”×•×¦×™× ××•×ª×• / Click {obj.emoji} to remove it</p>}
                                </>
                            ) : (
                                <>
                                    <p className="text-lg">×¡×¤×•×¨ ××ª ×”{obj.he} ×©× ×©××¨×•</p>
                                    <p className="text-lg">Count the remaining {obj.en}</p>
                                    {startNum > 0 && <p className="text-md text-gray-600">×œ×—×¥ ×¢×œ {obj.emoji} ×›×“×™ ×œ×¡×¤×•×¨ ××•×ª×• / Click {obj.emoji} to count it</p>}
                                </>
                            )}
                        </div>
                        
                        <div className="bg-green-50 rounded-lg p-8 min-h-[300px] flex items-center justify-center">
                            {startNum === 0 ? (
                                <p className="text-2xl text-gray-500">××™×Ÿ {obj.he} / No {obj.en}</p>
                            ) : (
                                <div className="grid grid-cols-5 gap-4 max-w-md">
                                    {apples.map((i) => {
                                        const isRemoved = removedApples.includes(i);
                                        const isCounted = appleMode === 'count' && countedApples.includes(i);
                                        const countNumber = isCounted ? countedApples.indexOf(i) + 1 : null;
                                        
                                        return (
                                            <button
                                                key={i}
                                                onClick={() => handleAppleClick(i)}
                                                className={`relative transform transition-all text-5xl ${
                                                    isRemoved 
                                                        ? 'opacity-30 scale-75' 
                                                        : 'opacity-100 scale-100 hover:scale-110'
                                                }`}
                                                style={{ 
                                                    filter: isCounted ? 'brightness(1.2) contrast(1.2)' : 'none'
                                                }}
                                            >
                                                <span style={{ 
                                                    filter: isRemoved ? 'grayscale(100%)' : 'none',
                                                    display: 'inline-block'
                                                }}>
                                                    {obj.emoji}
                                                </span>
                                                {isCounted && showAppleNumbers && (
                                                    <div className="absolute inset-0 flex items-center justify-center">
                                                        <span className="text-2xl font-bold text-white drop-shadow-[0_2px_2px_rgba(0,0,0,0.8)]">
                                                            {countNumber}
                                                        </span>
                                                    </div>
                                                )}
                                            </button>
                                        );
                                    })}
                                </div>
                            )}
                        </div>
                        
                        <div className="text-center">
                            <button
                                onClick={resetLab}
                                className="px-6 py-3 bg-blue-500 text-white rounded-lg text-xl hover:bg-blue-600"
                            >
                                ğŸ”„ ××™×¤×•×¡ / Reset
                            </button>
                        </div>
                    </div>
                );
            };

            const FingersTab = () => {
                const numHands = Math.max(1, Math.ceil(startNum / 5));
                
                const handleFingerClick = (handIndex, fingerIndex) => {
                    const globalIndex = handIndex * 5 + fingerIndex;
                    if (globalIndex >= startNum) return;
                    
                    if (closedFingers.includes(globalIndex)) {
                        if (fingerMode === 'mark') {
                            setClosedFingers(closedFingers.filter(i => i !== globalIndex));
                        }
                        return;
                    }
                    
                    if (fingerMode === 'mark') {
                        if (closedFingers.length < subtractNum) {
                            setClosedFingers([...closedFingers, globalIndex]);
                        }
                    } else {
                        if (countedFingers.includes(globalIndex)) {
                            setCountedFingers(countedFingers.filter(i => i !== globalIndex));
                        } else {
                            setCountedFingers([...countedFingers, globalIndex]);
                        }
                    }
                };
                
                const Hand = ({ handIndex }) => {
                    const Finger = ({ fingerIndex }) => {
                        const globalIndex = handIndex * 5 + fingerIndex;
                        const isAvailable = globalIndex < startNum;
                        const positions = [
                            { x: 5, width: 15 },
                            { x: 23, width: 13 },
                            { x: 39, width: 13 },
                            { x: 55, width: 13 },
                            { x: 71, width: 12 }
                        ];
                        const pos = positions[fingerIndex];
                        const isClosed = closedFingers.includes(globalIndex);
                        const isCounted = fingerMode === 'count' && countedFingers.includes(globalIndex);
                        const countNumber = isCounted ? countedFingers.indexOf(globalIndex) + 1 : null;
                        
                        const opacity = isAvailable ? 1 : 0.2;
                        const fingerColor = isAvailable 
                            ? (isClosed ? '#9ca3af' : isCounted ? '#10b981' : '#fbbf24') 
                            : '#e5e7eb';
                        
                        return (
                            <g 
                                onClick={() => isAvailable && handleFingerClick(handIndex, fingerIndex)} 
                                className={isAvailable ? "cursor-pointer" : "cursor-not-allowed"}
                                opacity={opacity}
                            >
                                <path
                                    d={`
                                        M ${pos.x} 70
                                        L ${pos.x} 45
                                        Q ${pos.x} 42 ${pos.x + pos.width/2} 40
                                        Q ${pos.x + pos.width} 42 ${pos.x + pos.width} 45
                                        L ${pos.x + pos.width} 70
                                        Z
                                    `}
                                    fill={fingerColor}
                                    stroke="#78716c"
                                    strokeWidth={1.5}
                                />
                                
                                <path
                                    d={`
                                        M ${pos.x + 1} 45
                                        L ${pos.x + 1} 25
                                        Q ${pos.x + 1} 20 ${pos.x + pos.width/2} 18
                                        Q ${pos.x + pos.width - 1} 20 ${pos.x + pos.width - 1} 25
                                        L ${pos.x + pos.width - 1} 45
                                    `}
                                    fill={fingerColor}
                                    stroke="#78716c"
                                    strokeWidth={1.5}
                                />
                                
                                <ellipse
                                    cx={pos.x + pos.width/2}
                                    cy={18}
                                    rx={pos.width/2 - 1}
                                    ry={6}
                                    fill={fingerColor}
                                    stroke="#78716c"
                                    strokeWidth={1.5}
                                />
                                
                                <ellipse
                                    cx={pos.x + pos.width/2}
                                    cy={16}
                                    rx={pos.width/3}
                                    ry={3}
                                    fill={isAvailable ? (isClosed ? '#d1d5db' : isCounted ? '#dcfce7' : '#fef3c7') : '#f3f4f6'}
                                    stroke="#78716c"
                                    strokeWidth={0.8}
                                />
                                
                                {isAvailable && !isClosed && (
                                    <>
                                        <line 
                                            x1={pos.x + 2} 
                                            y1={45} 
                                            x2={pos.x + pos.width - 2} 
                                            y2={45} 
                                            stroke={isCounted ? '#059669' : '#d97706'} 
                                            strokeWidth={1}
                                            opacity={0.6}
                                        />
                                        <line 
                                            x1={pos.x + 2} 
                                            y1={32} 
                                            x2={pos.x + pos.width - 2} 
                                            y2={32} 
                                            stroke={isCounted ? '#059669' : '#d97706'} 
                                            strokeWidth={0.8}
                                            opacity={0.5}
                                        />
                                    </>
                                )}
                                
                                {isClosed && isAvailable && (
                                    <g>
                                        <line 
                                            x1={pos.x + 3} 
                                            y1={38} 
                                            x2={pos.x + pos.width - 3} 
                                            y2={55} 
                                            stroke="#ef4444" 
                                            strokeWidth={2.5} 
                                        />
                                        <line 
                                            x1={pos.x + pos.width - 3} 
                                            y1={38} 
                                            x2={pos.x + 3} 
                                            y2={55} 
                                            stroke="#ef4444" 
                                            strokeWidth={2.5} 
                                        />
                                    </g>
                                )}
                                
                                {isCounted && showFingerNumbers && isAvailable && (
                                    <text 
                                        x={pos.x + pos.width/2} 
                                        y={50} 
                                        textAnchor="middle" 
                                        className="text-2xl font-bold"
                                        fill="white"
                                        stroke="#000"
                                        strokeWidth={0.5}
                                    >
                                        {countNumber}
                                    </text>
                                )}
                            </g>
                        );
                    };
                    
                    return (
                        <svg viewBox="0 0 90 100" className="w-32 h-36">
                            <ellipse cx="45" cy="82" rx="40" ry="16" fill="#fbbf24" stroke="#78716c" strokeWidth={2} />
                            
                            <path 
                                d="M 15 75 Q 45 78 75 75" 
                                stroke="#d97706" 
                                strokeWidth={1} 
                                fill="none" 
                                opacity={0.4}
                            />
                            <path 
                                d="M 20 82 Q 45 85 70 82" 
                                stroke="#d97706" 
                                strokeWidth={1} 
                                fill="none" 
                                opacity={0.3}
                            />
                            
                            {Array.from({ length: 5 }, (_, i) => (
                                <Finger key={i} fingerIndex={i} />
                            ))}
                        </svg>
                    );
                };
                
                return (
                    <div className="space-y-6">
                        <div className="flex justify-center gap-4 items-center flex-wrap">
                            <button
                                onClick={() => {
                                    setFingerMode('mark');
                                    setCountedFingers([]);
                                }}
                                className={`px-6 py-3 rounded-lg text-lg font-semibold flex items-center gap-2 ${
                                    fingerMode === 'mark'
                                        ? 'bg-red-500 text-white'
                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }`}
                            >
                                âœ• ×¡××Ÿ / Mark
                            </button>
                            <button
                                onClick={() => {
                                    setFingerMode('count');
                                    setCountedFingers([]);
                                }}
                                className={`px-6 py-3 rounded-lg text-lg font-semibold flex items-center gap-2 ${
                                    fingerMode === 'count'
                                        ? 'bg-green-500 text-white'
                                        : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                }`}
                            >
                                ğŸ”¢ ×¡×¤×•×¨ / Count
                            </button>
                            
                            {fingerMode === 'count' && (
                                <label className="flex items-center gap-2 text-lg bg-white px-4 py-2 rounded-lg border-2 border-gray-300">
                                    <input
                                        type="checkbox"
                                        checked={showFingerNumbers}
                                        onChange={(e) => setShowFingerNumbers(e.target.checked)}
                                        className="w-5 h-5"
                                    />
                                    <span>×”×¦×’ ××¡×¤×¨×™× / Show Numbers</span>
                                </label>
                            )}
                        </div>
                        
                        <div className="text-center space-y-2">
                            {fingerMode === 'mark' ? (
                                <>
                                    <p className="text-lg">×™×© ×œ×š {startNum} ××¦×‘×¢×•×ª, ×¡××Ÿ {subtractNum} ××¦×‘×¢×•×ª</p>
                                    <p className="text-lg">You have {startNum} fingers, mark {subtractNum} fingers</p>
                                    {startNum > 0 && <p className="text-md text-gray-600">×œ×—×¥ ×¢×œ ××¦×‘×¢ ×›×“×™ ×œ×¡××Ÿ ××•×ª×” / Click a finger to mark it</p>}
                                </>
                            ) : (
                                <>
                                    <p className="text-lg">×¡×¤×•×¨ ××ª ×”××¦×‘×¢×•×ª ×©× ×©××¨×•</p>
                                    <p className="text-lg">Count the remaining fingers</p>
                                    {startNum > 0 && <p className="text-md text-gray-600">×œ×—×¥ ×¢×œ ××¦×‘×¢ ×›×“×™ ×œ×¡×¤×•×¨ ××•×ª×” / Click a finger to count it</p>}
                                </>
                            )}
                        </div>
                        
                        <div className="bg-amber-50 rounded-lg p-8">
                            {startNum === 0 ? (
                                <p className="text-center text-2xl text-gray-500">××™×Ÿ ××¦×‘×¢×•×ª / No fingers</p>
                            ) : (
                                <div className="flex flex-wrap justify-center gap-8">
                                    {Array.from({ length: numHands }, (_, i) => (
                                        <Hand key={i} handIndex={i} />
                                    ))}
                                </div>
                            )}
                        </div>
                        
                        <div className="text-center">
                            <button
                                onClick={resetLab}
                                className="px-6 py-3 bg-blue-500 text-white rounded-lg text-xl hover:bg-blue-600"
                            >
                                ğŸ”„ ××™×¤×•×¡ / Reset
                            </button>
                        </div>
                    </div>
                );
            };

            const SettingsTab = () => {
                return (
                    <div className="space-y-8">
                        <div className="text-center">
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">×”×’×“×¨×•×ª / Settings</h2>
                            <p className="text-sm text-gray-600">×”×”×’×“×¨×•×ª × ×©××¨×•×ª ××•×˜×•××˜×™×ª / Settings are saved automatically</p>
                        </div>
                        
                        <div className="bg-blue-50 rounded-lg p-6 space-y-6">
                            <div>
                                <h3 className="text-xl font-semibold mb-4 text-center">×˜×•×•×— ×”××¡×¤×¨ ×”×¨××©×•×Ÿ / First Number Range</h3>
                                <div className="flex justify-center gap-6 items-center flex-wrap">
                                    <div className="text-center">
                                        <label className="block text-sm mb-1 font-medium">××™× ×™××•× / Min</label>
                                        <input
                                            type="number"
                                            min="0"
                                            max="20"
                                            value={firstNumMin}
                                            onChange={(e) => {
                                                const val = parseInt(e.target.value) || 0;
                                                setFirstNumMin(Math.min(val, firstNumMax));
                                            }}
                                            className="w-20 px-3 py-2 text-xl text-center border-2 border-blue-300 rounded"
                                        />
                                    </div>
                                    <span className="text-2xl mt-5">â€”</span>
                                    <div className="text-center">
                                        <label className="block text-sm mb-1 font-medium">××§×¡×™××•× / Max</label>
                                        <input
                                            type="number"
                                            min={firstNumMin}
                                            max="20"
                                            value={firstNumMax}
                                            onChange={(e) => {
                                                const val = parseInt(e.target.value) || firstNumMin;
                                                setFirstNumMax(Math.max(val, firstNumMin));
                                            }}
                                            className="w-20 px-3 py-2 text-xl text-center border-2 border-blue-300 rounded"
                                        />
                                    </div>
                                </div>
                            </div>
                            
                            <div className="border-t-2 border-blue-200 pt-6">
                                <h3 className="text-xl font-semibold mb-4 text-center">×˜×•×•×— ×”××¡×¤×¨ ×œ×—×™×¡×•×¨ / Subtract Number Range</h3>
                                <div className="flex justify-center gap-6 items-center flex-wrap">
                                    <div className="text-center">
                                        <label className="block text-sm mb-1 font-medium">××™× ×™××•× / Min</label>
                                        <input
                                            type="number"
                                            min="0"
                                            max="20"
                                            value={subtractMin}
                                            onChange={(e) => {
                                                const val = parseInt(e.target.value) || 0;
                                                setSubtractMin(Math.min(val, subtractMax));
                                            }}
                                            className="w-20 px-3 py-2 text-xl text-center border-2 border-blue-300 rounded"
                                        />
                                    </div>
                                    <span className="text-2xl mt-5">â€”</span>
                                    <div className="text-center">
                                        <label className="block text-sm mb-1 font-medium">××§×¡×™××•× / Max</label>
                                        <input
                                            type="number"
                                            min={subtractMin}
                                            max="20"
                                            value={subtractMax}
                                            onChange={(e) => {
                                                const val = parseInt(e.target.value) || subtractMin;
                                                setSubtractMax(Math.max(val, subtractMin));
                                            }}
                                            className="w-20 px-3 py-2 text-xl text-center border-2 border-blue-300 rounded"
                                        />
                                    </div>
                                </div>
                            </div>
                            
                            <div className="border-t-2 border-blue-200 pt-6">
                                <h3 className="text-xl font-semibold mb-4 text-center">×’×•×“×œ × ×§×•×“×•×ª ×¦×™×¨ / Axis Dot Size</h3>
                                <div className="flex justify-center gap-4 flex-wrap">
                                    {['small', 'medium', 'large'].map(size => (
                                        <button
                                            key={size}
                                            onClick={() => setDotSize(size)}
                                            className={`px-6 py-3 rounded-lg text-lg font-semibold ${
                                                dotSize === size
                                                    ? 'bg-blue-500 text-white'
                                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                            }`}
                                        >
                                            {size === 'small' ? '×§×˜×Ÿ / Small' : size === 'medium' ? '×‘×™× ×•× ×™ / Medium' : '×’×“×•×œ / Large'}
                                        </button>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="border-t-2 border-blue-200 pt-6">
                                <h3 className="text-xl font-semibold mb-4 text-center">×¡×•×’ ××•×‘×™×™×§×˜ / Object Type</h3>
                                <div className="flex justify-center gap-3 flex-wrap">
                                    {[
                                        { type: 'apple', emoji: 'ğŸ', label: '×ª×¤×•×— / Apple' },
                                        { type: 'orange', emoji: 'ğŸŠ', label: '×ª×¤×•×– / Orange' },
                                        { type: 'banana', emoji: 'ğŸŒ', label: '×‘× × ×” / Banana' },
                                        { type: 'strawberry', emoji: 'ğŸ“', label: '×ª×•×ª / Strawberry' },
                                        { type: 'ball', emoji: 'âš½', label: '×›×“×•×¨ / Ball' },
                                        { type: 'butterfly', emoji: 'ğŸ¦‹', label: '×¤×¨×¤×¨ / Butterfly' },
                                        { type: 'unicorn', emoji: 'ğŸ¦„', label: '×—×“ ×§×¨×Ÿ / Unicorn' },
                                        { type: 'mouse', emoji: 'ğŸ­', label: '×¢×›×‘×¨ / Mouse' },
                                        { type: 'dress', emoji: 'ğŸ‘—', label: '×©××œ×” / Dress' },
                                        { type: 'shoe', emoji: 'ğŸ‘ ', label: '× ×¢×œ / Shoe' },
                                        { type: 'cookie', emoji: 'ğŸª', label: '×¢×•×’×™×™×” / Cookie' },
                                        { type: 'chair', emoji: 'ğŸª‘', label: '×›×™×¡× / Chair' },
                                        { type: 'star', emoji: 'â­', label: '×›×•×›×‘ / Star' },
                                        { type: 'shirt', emoji: 'ğŸ‘•', label: '×—×•×œ×¦×” / Shirt' },
                                        { type: 'trousers', emoji: 'ğŸ‘–', label: '××›× ×¡×™×™× / Trousers' },
                                        { type: 'clown', emoji: 'ğŸ¤¡', label: '×œ×™×¦×Ÿ / Clown' }
                                    ].map(item => (
                                        <button
                                            key={item.type}
                                            onClick={() => setObjectType(item.type)}
                                            className={`px-4 py-3 rounded-lg text-base font-semibold flex items-center gap-2 ${
                                                objectType === item.type
                                                    ? 'bg-pink-500 text-white'
                                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                                            }`}
                                        >
                                            <span className="text-2xl">{item.emoji}</span>
                                            <span className="text-sm">{item.label}</span>
                                        </button>
                                    ))}
                                </div>
                            </div>
                            
                            <div className="text-center text-sm text-gray-600 pt-4">
                                <p>×‘×¨×™×¨×ª ××—×“×œ: ××¡×¤×¨ ×¨××©×•×Ÿ 5-13, ×—×™×¡×•×¨ 0-13</p>
                                <p>Default: First number 5-13, Subtract 0-13</p>
                                <p>× ×§×•×“×•×ª ×‘×™× ×•× ×™×•×ª, ×ª×¤×•×—×™× / Medium dots, Apples</p>
                                <p className="text-pink-500 font-semibold mt-2">âœ¨ ××¤×©×¨×•×™×•×ª ×—×“×©×•×ª ×œ×‘× ×•×ª! / New girly options! âœ¨</p>
                            </div>
                        </div>
                    </div>
                );
            };

            // Celebration overlay component
            const CelebrationOverlay = ({ celebration }) => {
                if (!celebration) return null;
                const count = 22;
                const particles = Array.from({ length: count }, (_, i) => {
                    const angle = (360 / count) * i;
                    const emoji = celebration.emojis[i % celebration.emojis.length];
                    const delay = (i % 4) * 0.06;
                    const duration = 1.8 + (i % 3) * 0.3;
                    return { angle, emoji, delay, duration };
                });
                return (
                    <div
                        key={celebration.key}
                        style={{
                            position: 'fixed', inset: 0,
                            display: 'flex', alignItems: 'center', justifyContent: 'center',
                            pointerEvents: 'none', zIndex: 9999,
                            animation: `celebration-bg-fade ${2.6}s ease forwards`
                        }}
                    >
                        {particles.map((p, i) => (
                            <span
                                key={i}
                                style={{
                                    position: 'absolute',
                                    top: '50%', left: '50%',
                                    fontSize: '2rem',
                                    '--angle': `${p.angle}deg`,
                                    animation: `fly-emoji ${p.duration}s ease-out ${p.delay}s both`,
                                    display: 'inline-block',
                                    lineHeight: 1,
                                }}
                            >
                                {p.emoji}
                            </span>
                        ))}
                    </div>
                );
            };

            return (
                <div className="max-w-4xl mx-auto p-6 bg-white min-h-screen" dir="rtl">
                    <CelebrationOverlay celebration={celebration} />
                    <h1 className="text-4xl font-bold text-center mb-4 text-blue-600">ğŸ’– VERSION 4.5 ğŸ’–<br/>
                        ××¢×‘×“×ª ×”×—×™×¡×•×¨ / Subtraction Lab
                    </h1>

                    {/* Score bar */}
                    <div className="flex justify-center items-center gap-6 mb-6" dir="ltr">
                        <div className="flex items-center gap-2 bg-green-50 border-2 border-green-300 rounded-xl px-5 py-2">
                            <span className="text-2xl">âœ…</span>
                            <span key={'c'+correctCount} className={correctCount > 0 ? 'score-pop' : ''} style={{display:'inline-block'}}>
                                <span className="text-3xl font-bold text-green-600">{correctCount}</span>
                            </span>
                        </div>
                        <div className="flex items-center gap-2 bg-red-50 border-2 border-red-300 rounded-xl px-5 py-2">
                            <span className="text-2xl">âŒ</span>
                            <span key={'w'+wrongCount} className={wrongCount > 0 ? 'score-pop' : ''} style={{display:'inline-block'}}>
                                <span className="text-3xl font-bold text-red-500">{wrongCount}</span>
                            </span>
                        </div>
                        <button
                            onClick={() => { setCorrectCount(0); setWrongCount(0); }}
                            className="text-sm text-gray-400 hover:text-gray-600 border border-gray-300 rounded-lg px-3 py-1"
                            title="Reset score / ××¤×¡ × ×™×§×•×“"
                        >
                            ğŸ”„ × ×™×§×•×“ / Score
                        </button>
                    </div>
                    
                    <div className="bg-purple-50 rounded-lg p-6 mb-8">
                        <div className="flex items-center justify-center gap-4 flex-wrap" dir="ltr">
                            <button
                                onClick={generateNewQuestion}
                                className="px-4 py-4 bg-gradient-to-br from-orange-400 to-red-500 text-white rounded-lg text-3xl hover:from-orange-500 hover:to-red-600 shadow-lg transform hover:scale-105 transition-all"
                                title="×©××œ×” ×—×“×©×” / New Question"
                            >
                                ğŸ²
                            </button>
                            
                            <div className="text-center">
                                <label className="block text-sm mb-1">Start with / ××ª×—×™×œ×™× ×¢×</label>
                                <input
                                    type="number"
                                    min="0"
                                    max="20"
                                    value={startNum}
                                    onChange={handleStartNumChange}
                                    className="w-24 px-3 py-2 text-2xl text-center border-2 border-purple-300 rounded"
                                />
                            </div>
                            
                            <Minus size={32} className="text-purple-600 mt-5" />
                            
                            <div className="text-center">
                                <label className="block text-sm mb-1">Subtract / ××—×¡×™×¨×™×</label>
                                <input
                                    type="number"
                                    min="0"
                                    max={startNum}
                                    value={subtractNum}
                                    onChange={handleSubtractNumChange}
                                    className="w-24 px-3 py-2 text-2xl text-center border-2 border-purple-300 rounded"
                                />
                            </div>
                            
                            <div className="text-3xl font-bold mt-5">=</div>
                            
                            <div className="text-center">
                                <label className="block text-sm mb-1">Answer / ×ª×©×•×‘×”</label>
                                <input
                                    type="number"
                                    value={userAnswer}
                                    onChange={(e) => setUserAnswer(e.target.value)}
                                    placeholder="?"
                                    className="w-24 px-3 py-2 text-2xl text-center border-2 border-purple-300 rounded"
                                />
                            </div>
                            
                            <button
                                onClick={() => {
                                    setUserAnswer('');
                                    setShowResult(false);
                                }}
                                className="px-4 py-2 mt-5 bg-orange-500 text-white rounded-lg hover:bg-orange-600 text-xl"
                                title="××—×§ ×ª×©×•×‘×” / Erase answer"
                            >
                                ğŸ§¹
                            </button>
                            
                            <button
                                onClick={() => {
                                    if (userAnswer === '') return;
                                    const isCorrect = parseInt(userAnswer) === correctAnswer;
                                    setShowResult(true);
                                    setResultAnimKey(k => k + 1);
                                    if (isCorrect) {
                                        setCorrectCount(c => c + 1);
                                        // find current object emoji for celebration mix-in
                                        const objEmojis = {
                                            apple:'ğŸ', orange:'ğŸŠ', banana:'ğŸŒ', strawberry:'ğŸ“',
                                            ball:'âš½', butterfly:'ğŸ¦‹', unicorn:'ğŸ¦„', mouse:'ğŸ­',
                                            dress:'ğŸ‘—', shoe:'ğŸ‘ ', cookie:'ğŸª', chair:'ğŸª‘',
                                            star:'â­', shirt:'ğŸ‘•', trousers:'ğŸ‘–', clown:'ğŸ¤¡'
                                        };
                                        triggerCelebration(objEmojis[objectType] || 'ğŸ‰');
                                    } else {
                                        setWrongCount(c => c + 1);
                                    }
                                }}
                                disabled={userAnswer === ''}
                                className="px-6 py-2 mt-5 bg-purple-500 text-white rounded-lg hover:bg-purple-600 disabled:bg-gray-300 disabled:cursor-not-allowed"
                            >
                                ×‘×“×•×§ / Check
                            </button>
                        </div>
                        
                        {showResult && userAnswer !== '' && (
                            <div className="text-center mt-4">
                                {parseInt(userAnswer) === correctAnswer ? (
                                    <p key={resultAnimKey} className="correct-bounce text-2xl font-bold text-green-600">
                                        âœ“ × ×›×•×Ÿ! ××¢×•×œ×”! / Correct! Excellent! ğŸŒŸ
                                    </p>
                                ) : (
                                    <p key={resultAnimKey} className="wrong-shake text-2xl font-bold text-red-600">
                                        âŒ × ×¡×” ×©×•×‘ / Try again
                                    </p>
                                )}
                            </div>
                        )}
                    </div>
                    
                    <div className="flex justify-center gap-2 mb-6 flex-wrap">
                        <button
                            onClick={() => setActiveTab('numberline')}
                            className={`px-6 py-3 rounded-lg font-semibold transition-colors ${
                                activeTab === 'numberline'
                                    ? 'bg-blue-500 text-white'
                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                            }`}
                        >
                            ×¦×™×¨ ××¡×¤×¨×™× / Number Line
                        </button>
                        <button
                            onClick={() => setActiveTab('apples')}
                            className={`px-6 py-3 rounded-lg font-semibold transition-colors ${
                                activeTab === 'apples'
                                    ? 'bg-red-500 text-white'
                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                            }`}
                        >
                            {objectType === 'apple' ? 'ğŸ ×ª×¤×•×—×™× / Apples' :
                             objectType === 'orange' ? 'ğŸŠ ×ª×¤×•×–×™× / Oranges' :
                             objectType === 'banana' ? 'ğŸŒ ×‘× × ×•×ª / Bananas' :
                             objectType === 'strawberry' ? 'ğŸ“ ×ª×•×ª×™× / Strawberries' :
                             objectType === 'ball' ? 'âš½ ×›×“×•×¨×™× / Balls' :
                             objectType === 'butterfly' ? 'ğŸ¦‹ ×¤×¨×¤×¨×™× / Butterflies' :
                             objectType === 'unicorn' ? 'ğŸ¦„ ×—×“×™ ×§×¨×Ÿ / Unicorns' :
                             objectType === 'mouse' ? 'ğŸ­ ×¢×›×‘×¨×™× / Mice' :
                             objectType === 'dress' ? 'ğŸ‘— ×©××œ×•×ª / Dresses' :
                             objectType === 'cookie' ? 'ğŸª ×¢×•×’×™×•×ª / Cookies' :
                             objectType === 'chair' ? 'ğŸª‘ ×›×™×¡××•×ª / Chairs' :
                             objectType === 'star' ? 'â­ ×›×•×›×‘×™× / Stars' :
                             objectType === 'shirt' ? 'ğŸ‘• ×—×•×œ×¦×•×ª / Shirts' :
                             objectType === 'trousers' ? 'ğŸ‘– ××›× ×¡×™×™× / Trousers' :
                             objectType === 'clown' ? 'ğŸ¤¡ ×œ×™×¦× ×™× / Clowns' :
                             'ğŸ‘  × ×¢×œ×™×™× / Shoes'}
                        </button>
                        <button
                            onClick={() => setActiveTab('fingers')}
                            className={`px-6 py-3 rounded-lg font-semibold transition-colors ${
                                activeTab === 'fingers'
                                    ? 'bg-amber-500 text-white'
                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                            }`}
                        >
                            âœ‹ ××¦×‘×¢×•×ª / Fingers
                        </button>
                        <button
                            onClick={() => setActiveTab('settings')}
                            className={`px-6 py-3 rounded-lg font-semibold transition-colors ${
                                activeTab === 'settings'
                                    ? 'bg-indigo-500 text-white'
                                    : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                            }`}
                        >
                            âš™ï¸ ×”×’×“×¨×•×ª / Settings
                        </button>
                    </div>
                    
                    <div className="bg-white rounded-lg shadow-lg p-6">
                        {activeTab === 'numberline' && <NumberLineTab />}
                        {activeTab === 'apples' && <ApplesTab />}
                        {activeTab === 'fingers' && <FingersTab />}
                        {activeTab === 'settings' && <SettingsTab />}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<SubtractionLab />, document.getElementById('root'));
    </script>
</body>
</html>
